# DocMind — План реализации (MVP)

Пошаговый план разработки. Каждый шаг самодостаточен и безопасен для выполнения по отдельности.

---

## Фаза 1: Подготовка проекта

### 1.1 Структура каталогов и конфигурация
- Создать папки: `backend/`, `frontend/`.
- Создать `requirements.txt` с зависимостями: FastAPI, uvicorn, sqlalchemy, PyMuPDF (или pdfplumber), openai, python-docx (опционально).
- Создать `.env.example` с полем `OPENAI_API_KEY=` и добавить `.env` в `.gitignore` (если ещё не добавлен).

### 1.2 Минимальный бэкенд
- В `backend/` создать `main.py`: запуск FastAPI, один тестовый маршрут `GET /health` (возвращает `{"status": "ok"}`).
- Убедиться, что сервер поднимается через `uvicorn backend.main:app --reload` из корня проекта.

---

## Фаза 2: База данных

### 2.1 Модели и подключение
- Создать `backend/database.py`: настройка SQLAlchemy, подключение к SQLite (файл `docmind.db` в корне или в `backend/`).
- Создать `backend/models.py`: модели `User` (id, username, created_at), `Document` (id, user_id, filename, file_path_or_content_ref, uploaded_at), `Result` (id, document_id, analysis_type, content, created_at).

### 2.2 Инициализация БД
- В `main.py` при старте приложения создавать таблицы (например, `Base.metadata.create_all(bind=engine)`).
- Добавить скрипт или эндпоинт для проверки: создание тестового пользователя и проверка записи в БД (можно временный `GET /debug/db` или отдельный скрипт).

---

## Фаза 3: Обработка документов

### 3.1 Извлечение текста
- Создать `backend/document_parser.py`.
- Реализовать извлечение текста для TXT (чтение файла как UTF-8 с обработкой ошибок).
- Реализовать извлечение текста для PDF (PyMuPDF или pdfplumber).
- Опционально: поддержка DOCX через python-docx.
- Единая функция вида `extract_text(file_path: str, filename: str) -> str`, определяющая тип по расширению и вызывающая нужный парсер.

### 3.2 Сохранение файлов
- Определить каталог для загрузок (например, `backend/uploads/` или `data/uploads/`).
- Сохранять загруженный файл на диск, в БД записывать путь (или идентификатор) и связь с пользователем.

---

## Фаза 4: Интеграция с OpenAI

### 4.1 Клиент и промпты
- Создать `backend/openai_client.py`: чтение `OPENAI_API_KEY` из переменных окружения, функция вызова OpenAI (например, chat completions с GPT-4).
- Создать `backend/prompts.py`: шаблоны промптов для типов анализа — Summary, Action Items, Risks, Explain in simple words. Промпты должны требовать краткий структурированный ответ на простом языке.

### 4.2 Сервис анализа
- Создать `backend/analysis_service.py`: принять document_id (или текст), тип анализа; извлечь текст документа, подставить промпт, вызвать OpenAI, сохранить результат в таблицу `results` и вернуть его.

---

## Фаза 5: API эндпоинты

### 5.1 Пользователь и «логин»
- `POST /api/login` или `POST /api/users`: тело `{"username": "..."}`. Если пользователь есть — вернуть его id и имя; если нет — создать и вернуть. Без пароля.

### 5.2 Документы и загрузка
- `GET /api/users/{user_id}/documents` — список документов пользователя (id, filename, uploaded_at).
- `POST /api/users/{user_id}/documents` — загрузка файла (multipart/form-data), сохранение на диск, запись в БД, возврат id документа.

### 5.3 Анализ и результаты
- `POST /api/analyze`: тело `{"document_id": ..., "analysis_type": "summary" | "action_items" | "risks" | "explain_simple"}`. Вызвать analysis_service, сохранить результат, вернуть id результата и контент.
- `GET /api/documents/{document_id}/results` — список результатов по документу (или один последний по типу — по желанию).
- `GET /api/results/{result_id}` — полный результат по id (для страницы результата).

---

## Фаза 6: Фронтенд — страницы и стиль

### 6.1 Разметка и навигация
- В `frontend/` создать `index.html` (точка входа): форма «Введите имя» и кнопка «Войти»; после «логина» редирект на dashboard (например, `dashboard.html?user_id=...`).
- Создать `dashboard.html`: заголовок с именем пользователя, список загруженных документов (пока статичный или пустой), кнопка «Загрузить документ» → `upload.html`.
- Создать `upload.html`: форма выбора файла (PDF/TXT), выбор типа анализа (Summary, Action Items, Risks, Explain in simple words), кнопка «Анализировать».
- Создать `result.html`: отображение результата анализа (один блок текста/разметки), кнопка «Назад к дашборду».

### 6.2 Стили
- Подключить один общий `frontend/styles.css`: базовый layout (шапка, контейнер, кнопки, форма), читаемые шрифты и отступы. Без фреймворков.

---

## Фаза 7: Фронтенд — логика (JavaScript)

### 7.1 Логин и дашборд
- В `index.html`: по отправке формы вызвать `POST /api/login` (или создание пользователя), сохранить `user_id` (и при необходимости username) в sessionStorage, перейти на `dashboard.html` с query или через sessionStorage.
- В `dashboard.html`: при загрузке страницы взять `user_id`, вызвать `GET /api/users/{user_id}/documents`, отрисовать список документов. Ссылки «Загрузить документ» ведут на `upload.html` с `user_id`.

### 7.2 Загрузка и анализ
- В `upload.html`: форма с file input и select (тип анализа). По отправке: `POST /api/users/{user_id}/documents` с файлом, получить document_id; затем `POST /api/analyze` с document_id и analysis_type. По ответу перейти на `result.html?result_id=...` или отобразить результат на той же странице.

### 7.3 Страница результата
- В `result.html`: по `result_id` из URL вызвать `GET /api/results/{result_id}`, вывести контент. Кнопка «Назад» ведёт на dashboard с тем же user_id.

---

## Фаза 8: Связка и раздача фронтенда

### 8.1 CORS и статика
- В FastAPI включить CORS для фронтенда (origin с localhost или статический список).
- Подключить раздачу статики: `mount("/", StaticFiles(directory="frontend", html=True))` или отдельный маршрут для `frontend/`, чтобы открывать `index.html` по корневому URL.

### 8.2 Базовый сценарий
- Проверить полный сценарий: логин → дашборд → загрузка файла → выбор типа анализа → получение ответа от ИИ → просмотр результата → возврат на дашборд. При необходимости поправить порядок вызовов и отображение ошибок.

---

## Фаза 9: Улучшения и завершение

### 9.1 Обработка ошибок
- Бэкенд: корректные HTTP-коды и сообщения при отсутствии пользователя/документа/результата, при ошибке парсера или OpenAI.
- Фронтенд: при ошибке Fetch показывать пользователю короткое сообщение (alert или блок на странице).

### 9.2 README и запуск
- Обновить README.md: как установить зависимости (`pip install -r requirements.txt`), как задать `OPENAI_API_KEY`, как запустить бэкенд и открыть фронтенд в браузере. Кратко описать сценарий использования.

---

## Порядок выполнения

Выполнять шаги по порядку: 1.1 → 1.2 → 2.1 → 2.2 → 3.1 → 3.2 → 4.1 → 4.2 → 5.1 → 5.2 → 5.3 → 6.1 → 6.2 → 7.1 → 7.2 → 7.3 → 8.1 → 8.2 → 9.1 → 9.2.

После каждой фазы имеет смысл проверить, что уже сделанное продолжает работать (например, health-check и ручные запросы к API).
