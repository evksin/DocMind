"""
Шаблоны промптов для типов анализа документов.
Краткий структурированный ответ на простом языке.
"""

# Ключи типов анализа (совпадают с API и фронтом)
SUMMARY = "summary"
ACTION_ITEMS = "action_items"
RISKS = "risks"
EXPLAIN_SIMPLE = "explain_simple"

ANALYSIS_TYPES = (SUMMARY, ACTION_ITEMS, RISKS, EXPLAIN_SIMPLE)


# Роли аудитории (для персональности тона)
AUDIENCE_OPTIONS = ("business", "legal", "manager", "student")


def get_system_prompt(analysis_type: str, audience: str | None = None) -> str:
    """
    Возвращает системный промпт (инструкцию) для выбранного типа анализа.
    audience: для кого документ (business, legal, manager, student) — влияет на тон.
    """
    base = (
        "Ты — помощник по анализу документов. "
        "Отвечай кратко, по делу, простыми словами (без сложных терминов). "
        "Форматируй ответ структурированно: списки, короткие абзацы.\n\n"
    )
    if audience:
        role_hint = {
            "business": "Документ для бизнес-аудитории: тон деловой, акцент на выгодах и решениях.",
            "legal": "Документ для юридической аудитории: точность формулировок, внимание к обязательствам и рискам.",
            "manager": "Документ для руководителя: краткость, выводы и следующие шаги.",
            "student": "Документ для студента: объясняй доступно, без лишнего жаргона.",
        }.get(audience.lower(), f"Учитывай, что документ для аудитории: {audience}.")
        base = base + role_hint + "\n\n"
    if analysis_type == SUMMARY:
        return (
            base
            + "Задача: сделать краткое изложение документа. "
            "Выдели главную мысль, основные темы и выводы. Объём: не более 1 страницы."
        )
    if analysis_type == ACTION_ITEMS:
        return (
            base
            + "Задача: выделить из документа конкретные действия и шаги (action items). "
            "Перечисли их списком, каждый пункт — одно чёткое действие. Без лишних пояснений."
        )
    if analysis_type == RISKS:
        return (
            base
            + "Задача: выявить риски и слабые места, упомянутые или подразумеваемые в документе. "
            "Перечисли риски списком, кратко поясни каждый. Язык — простой."
        )
    if analysis_type == EXPLAIN_SIMPLE:
        return (
            base
            + "Задача: объяснить содержание документа простыми словами, как для человека без специальной подготовки. "
            "Сохрани смысл, но избегай жаргона и сложных формулировок."
        )
    raise ValueError(f"Неизвестный тип анализа: {analysis_type}")


def get_user_content(document_text: str) -> str:
    """
    Текст документа для user-сообщения. Можно обрезать по длине, если нужно уложиться в лимиты.
    """
    if not document_text or not document_text.strip():
        return "[Документ пуст или текст не извлечён.]"
    # Лимит входа OpenRouter (prompt tokens). ~6000 символов ≈ 2000–2500 токенов, укладываемся в 7093
    max_chars = 6_000
    text = document_text.strip()
    if len(text) > max_chars:
        text = text[:max_chars] + "\n\n[... документ обрезан из-за лимита длины ...]"
    return text
